<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Car Lease Calculator - Stable Build 3</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the Inter font and to ensure full height for centering */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F5EE; /* Softer, warmer off-white background */
            min-height: 100vh; /* Allow content to push height */
            overflow-y: auto; /* Enable scrolling if content overflows */
            display: block; /* Use block display for natural scrolling */
        }
        .container {
            max-width: 90rem; /* Increased max-width for a wider page */
            margin-left: auto; /* Center horizontally */
            margin-right: auto; /* Center horizontally */
            padding: 1rem; /* Add padding */
        }
        /* Style for the monthly payment display */
        #monthlyPayment, #dueAtSigningDisplay, #totalCostOfOwnershipDisplay, #effectiveMonthlyCost {
            min-width: 150px; /* Ensure sufficient width for the display */
            display: inline-block; /* Allow padding and background */
            padding: 0.5rem 1rem;
            background-color: #FFFBEB; /* Light yellow for warmer output display */
            border-radius: 0.5rem; /* Rounded corners */
            color: #B45309; /* Darker amber text for warmer feel */
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08); /* Subtle shadow for output boxes */
        }
        /* Style for the range input (slider) track */
        input[type="range"]::-webkit-slider-runnable-track {
            background: #FDE68A; /* Light amber for track */
            border-radius: 0.5rem;
            height: 6px; /* Slightly thicker track */
        }
        input[type="range"]::-moz-range-track {
            background: #FDE68A; /* Light amber for track */
            border-radius: 0.5rem;
            height: 6px; /* Slightly thicker track */
        }
        input[type="range"]::-ms-track {
            background: #FDE68A; /* Light amber for track */
            border-radius: 0.5rem;
            height: 6px; /* Slightly thicker track */
        }
        /* Style for the range input (slider) thumb */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; /* Override default appearance */
            height: 18px; /* Slightly larger thumb */
            width: 18px; /* Slightly larger thumb */
            border-radius: 50%;
            background: #D97706; /* Darker amber for thumb */
            cursor: pointer;
            margin-top: -6px; /* Center thumb vertically for 6px track */
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.3); /* Amber shadow */
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
            background-color: #B45309; /* Even darker amber on hover */
            transform: scale(1.1);
        }
        input[type="range"]::-moz-range-thumb {
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #D97706; /* Darker amber for thumb */
            cursor: pointer;
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.3); /* Amber shadow */
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        input[type="range"]::-moz-range:hover {
            background-color: #B45309;
            transform: scale(1.1);
        }
        input[type="range"]::-ms-thumb {
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #D97706; /* Darker amber for thumb */
            cursor: pointer;
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.3); /* Amber shadow */
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        input[type="range"]::-ms-thumb:hover {
            background-color: #B45309;
            transform: scale(1.1);
        }

        /* Required field styling */
        .required-field-error {
            border-color: #ef4444 !important; /* Tailwind red-500 */
            box-shadow: 0 0 0 1px #ef4444 !important; /* Tailwind red-500 */
        }

        /* Input field for scenario labels */
        .scenario-label-input::placeholder {
            color: #9ca3af; /* Tailwind gray-400 for placeholder */
        }
        .scenario-label-input {
            color: #D97706; /* Warmer orange for typed text */
            padding-left: 0.75rem; /* Match other inputs */
            padding-right: 0.75rem; /* Match other inputs */
        }

        /* General input/select styling enhancements */
        .shadow-sm.appearance-none.border.rounded-lg.w-full.py-2.px-3.text-gray-700.leading-tight,
        .shadow-sm.appearance-none.border.rounded-lg.w-full.py-1.5.px-2.text-gray-700.leading-tight {
            transition: all 0.2s ease-in-out;
            border: 1px solid #d1d5db; /* Tailwind gray-300 */
        }
        .shadow-sm.appearance-none.border.rounded-lg.w-full.py-2.px-3.text-gray-700.leading-tight:focus,
        .shadow-sm.appearance-none.border.rounded-lg.w-full.py-1.5.px-2.text-gray-700.leading-tight:focus {
            outline: none;
            border-color: #FBBF24; /* Tailwind amber-400 for focus border */
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.3); /* Softer amber ring */
        }

        /* Button styling enhancements */
        button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Subtle shadow for all buttons */
            border-radius: 0.75rem; /* More rounded corners for all buttons */
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        /* Specific styles for Clear/Print buttons */
        .absolute.top-0.left-0.text-gray-600.hover\:text-gray-800.text-sm.font-semibold.py-1.px-3.rounded-lg.border.border-gray-300.hover\:bg-gray-100,
        .absolute.top-0.right-0.text-gray-600.hover\:text-gray-800.text-sm.font-semibold.py-1.px-3.rounded-lg.border.border-gray-300.hover\:bg-gray-100 {
            padding: 0.5rem 1rem; /* Slightly larger touch target */
            margin: 0.75rem; /* Add more margin from corners */
            background-color: #fcfcfc; /* Lighter background */
            border-color: #e5e7eb; /* Softer border */
        }

        /* Save/Load Scenario buttons */
        .text-blue-600.hover\:text-blue-800.text-base.font-semibold.py-2.px-4.rounded-lg.border.border-blue-300.hover\:bg-blue-50 {
            background-color: #FFF7ED; /* Very light orange/cream background */
            border-color: #FDBA74; /* Tailwind orange-300 */
            color: #EA580C; /* Tailwind orange-600 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            border-radius: 0.75rem; /* Ensure rounded corners */
        }
        .text-blue-600.hover\:text-blue-800.text-base.font-semibold.py-2.px-4.rounded-lg.border.border-blue-300.hover\:bg-blue-50:hover {
            background-color: #FEEED0; /* Lighter orange/cream on hover */
            color: #C2410C; /* Darker orange on hover */
        }

        .text-gray-600.hover\:text-gray-800.text-base.font-semibold.py-2.px-4.rounded-lg.border.border-gray-300.hover\:bg-gray-100 {
            background-color: #f9fafb; /* Lighter gray background */
            border-color: #e5e7eb; /* Tailwind gray-200 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-radius: 0.75rem; /* Ensure rounded corners */
        }
        /* Specific styling for SAVED scenario buttons */
        .text-blue-700.border-blue-500.hover\:text-blue-900.bg-blue-100 {
            background-color: #FFEDD5; /* Very light orange */
            border-color: #FDBA74; /* Tailwind orange-300 */
            font-weight: bold;
            color: #C2410C; /* Tailwind orange-700 */
        }
        .text-blue-700.border-blue-500.hover\:text-blue-900.bg-blue-100:hover {
            background-color: #FED7AA; /* Tailwind orange-200 on hover */
        }

        /* Financial Summary boxes */
        .bg-gray-50.p-3.rounded-lg.border.border-gray-200 {
            background-color: #fdfaf5; /* Slightly warmer white than gray-50 */
            border-color: #FAEBD7; /* Lighter orange-ish border */
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); /* Softer shadow */
        }
        /* Specific styling for breakdown sections */
        #dueAtSigningDetails, #monthlyPaymentDetails, #totalCostOfOwnershipDetails {
            background-color: #FFFBF0; /* Lightest warm tone for breakdown details */
            border: 1px solid #FFE6C7; /* Matching warm border */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); /* Inner shadow for depth */
        }

        /* Fixed header shadow enhancement */
        .fixed.top-0.left-0.right-0.bg-gray-100.z-20.pb-8.shadow-md {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); /* Stronger shadow for fixed header */
            background-color: #F8F5EE; /* Match body background for seamless look */
        }
        /* Adjust main content top margin for fixed header */
        .mt-24 { /* This is 6rem */
            margin-top: 6.5rem; /* A little extra space to ensure no overlap */
        }
        /* Adjust sticky top value to account for potential header height changes */
        .sticky {
            position: sticky; /* Ensure sticky position is applied */
            top: 7rem; /* Approximately 112px, adjust as needed based on header height */
            /* Ensure it has a z-index higher than main content but lower than fixed header */
            z-index: 10;
            align-self: flex-start; /* Crucial for sticky within a flex container */
            height: fit-content; /* Ensure it only takes up necessary height for sticky to work correctly */
        }

        /* Print-specific styles - keep them lean and functional */
        @media print {
            body {
                background-color: #fff;
                min-height: auto;
                display: block;
                margin: 0;
                padding: